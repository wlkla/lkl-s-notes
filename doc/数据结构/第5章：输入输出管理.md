# 输入输出管理

[TOC]

## I/O管理概述

### I/O设备

1. 设备的分类
   - 按信息交换的单位分类
     - 块设备：信息交换以数据块为单位。基本特征是传输速率较高、可寻址
     - 字符设备：信息交换以数据块为单位。基本特征是传输速率较低、不可寻址
   - 按设备的传输速率分类
     - 低速设备
     - 中速设备
     - 高速设备
   - 按设备的使用特性
     - 存储设备：用于存储信息的外部设备
     - 输入/输出设备：输入设备用于像计算机输入外部信息；输出设备用于计算机向外输出数据信息；交互式设备则集成了输入输出设备的功能
   - 按设备的共享属性
     - 独占设备：同一时刻只能有一个进程占用的设备
     - 共享设备：同一时间段内允许多个进程同时访问的设备
     - 虚拟设备：通过SPOOLing技术将占用设备改造成共享设备，将一个物理设备变为多个逻辑设备，从而可将设备同时分配给多个进程
2. I/O接口（又称设备控制器）是CPU和设备之间的接口，以实现设备和计算机之间的数据交换
3. 设备控制器的组成
   - 设备控制器与CPU的接口：该接口有三类信号线：数据线、地址线、控制新
   - 设备控制器与设备的接口：一个设备控制器可以连接一个或多个设备，因此控制器中有一个或多个设备接口。每个接口都可以传输数据、控制、状态三种类型的信号
   - I/O逻辑：用于实现对设备的控制。通过控制线与CPU交互，对从CPU收到的I/O命令进行译码
4. 设备控制器的主要作用
   - 接受和识别命令
   - 数据交换，包括CPU和控制器之间的数据传输，以及控制器和设备之间的数据传输
   - 标识和报告设备的状态，供CPU处理
   - 地址识别
   - 数据缓冲
   - 差错控制
5. I/O接口的类型
   - 按数据传送方式
     - 并行接口
     - 串行接口
   - 按主机访问I/O设备的控制方式
     - 程序查询接口
     - 中断接口
     - DMA接口
   - 按功能选择的灵活性
     - 可编程接口
     - 不可编程接口
6. I/O端口：设备控制器中可被CPU直接访问的寄存器
   - 数据寄存器：用于缓存从设备送来的输入数据，或从CPU送来的输出数据
   - 状态寄存器：保存设备的执行结果或状态信息，供CPU读取
   - 控制寄存器：由CPU写入，以便启动命令或更改设备模式
7. I/O端口要想能够被CPU访问，就要对各个端口进行编址，方式有：
   - 独立编址
     - I/O端口的地址空间与主存地址空间是两个独立的地址空间
     - 优点：I/O端口数比主存单元少得多，只需要少量地址线，使得I/O端口译码简单，寻址更快。使用专门的I/O指令，可使程序更加清晰
     - 缺点：I/O指令少，只提供简单的传输操作，所以程序设计的灵活性较差。CPU需要提供两组独立的存储器和设备的读写控制信号，增加了控制的复杂性
   - 统一编址
     - 将主存地址空间分出一部分分给I/O端口进行编址，I/O端口和主存单元在同一地址空间的不同分段中
     - 优点：不需要专门的I/O指令，使得CPU访问I/O的操作更加灵活和方便，还使得端口有较大编制空间。I/O访问的保护机制可由虚拟存储管理系统来实现，无需专门设置
     - 缺点：端口地址占用主存地址空间，使主存可用容量变小。由于在识别端口时所有地址线都要译码，因此译码电路复杂，降低了寻址速度

### I/O控制方法

1. 程序直接控制方式
   - CPU对I/O设备的控制采取轮询的I/O方式，又称程序轮询方式。CPU向设备控制器发出一条I/O指令，启动从I/O设备读取一个字，然后不断循环测试设备状态，直到确定该字已在设备控制器的数据寄存器中
   - 优点：实现简单
   - 缺点：CPU与I/O设备穿行工作，CPU利用率低
2. 中断驱动方式
   - 允许I/O设备主动打断CPU的运行并请求服务，使得CPU向设备控制器发送一条I/O指令后可以继续做其他有用的工作
   - 设备控制器通过中断主动向CPU报告I/O已经完成，不再需要轮询，CPU与I/O设备并行工作，CPU利用率提高
   - 缺点
     - 设备与内存之间的数据交换必须通过CPU中的寄存器
     - CPU是以字为单位进行干预的，效率较低
3. DMA方式
   - 在I/O设备与内存之间开辟直接数据交换通路
   - 基本传送单位是块，不再是字
   - 所传输的数据不再经过CPU
   - 仅在传送数据开始和结束时才需要CPU干预
   - DMA控制器中设置的寄存器
     - 命令/状态寄存器CR：接收从CPU发来的I/O命令、有关控制信息或设备的状态
     - 内存地址寄存器MAR：在输入时，存放将数据从设备传送到内存的起始目标地址，在输出时，存放由内存到设备的内存源地址
     - 数据寄存器DR：暂存从内存到设备或从设备到内存的数据
     - 数据计数器DC：存放本次要传送的字（节）数
   - CPU接受到设备的DMA请求时，向DMA控制器发出一条命令，同时设置MAR和DC的值，启动DMA控制器，然后CPU执行其他任务。之后将I/O控制权交给DMA控制器，由DMA控制器负责数据传送。DMA控制器直接与内存交互，每次传送一个字。传送结束后，DMA控制器向CPU发送中断信号
4. 通道控制方式
   - I/O通道是一种特殊的处理机，可移植性一系列通道指令
   - CPU只需要向通道发送一条I/O指令，指明通道程序在内存中的位置和要访问的I/O设备，通道收到该指令后，执行通道程序，完成规定的I/O任务后，向CPU发出中断请求
   - 通道方式可以实现CPU、通道和I/O设备三者的并行工作，从而提高整个系统的资源利用率
   - DMA方式需要CPU控制传输的数据块大小，传输的内存位置，而通道方式中这些信息由通道控制。每个DMA控制器对应一台设备与内存传递数据，而一个通道可以控制多台设备与内存进行数据交换

### I/O软件层次结构

1. I/O软件普遍采用层次式结构
   <svg width="680" height="454" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" overflow="hidden"><g><rect x="0" y="0" width="680" height="453.722" fill="#FFFFFF" fill-opacity="0"/><rect x="129.5" y="113.681" width="422" height="58.0924" stroke="#042433" stroke-width="1.33268" stroke-miterlimit="8" fill="none"/><text font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="24" transform="matrix(1 0 0 1.00159 280.029 150)">用户层软件</text><rect x="129.5" y="171.773" width="422" height="58.0924" stroke="#042433" stroke-width="1.33268" stroke-miterlimit="8" fill="none"/><text font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="24" transform="matrix(1 0 0 1.00159 256.041 208)">设备独立性软件</text><rect x="129.5" y="229.866" width="422" height="58.0924" stroke="#042433" stroke-width="1.33268" stroke-miterlimit="8" fill="none"/><text font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="24" transform="matrix(1 0 0 1.00159 268.035 266)">设备驱动程序</text><rect x="129.5" y="287.958" width="422" height="58.0924" stroke="#042433" stroke-width="1.33268" stroke-miterlimit="8" fill="none"/><text font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="24" transform="matrix(1 0 0 1.00159 268.035 325)">中断处理程序</text><rect x="129.5" y="346.051" width="422" height="58.0923" stroke="#042433" stroke-width="1.33268" stroke-miterlimit="8" stroke-dasharray="10.6614 3.99804 1.33268 3.99804 1.33268 3.99804" fill="none"/><text font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="24" transform="matrix(1 0 0 1.00159 316.012 383)">硬件</text><path d="M162.999 95.1514 163 124.9 161.001 124.9 161 95.1514ZM165.998 123.565 162 131.574 158.002 123.565Z"/><path d="M162.999 153.244 163 182.992 161.001 182.992 161 153.244ZM165.998 181.657 162 189.666 158.002 181.657Z"/><path d="M162.999 211.336 163 241.084 161.001 241.084 161 211.336ZM165.998 239.749 162 247.758 158.002 239.75Z"/><path d="M162.999 268.427 163 298.175 161.001 298.175 161 268.427ZM165.998 296.84 162 304.849 158.002 296.84Z"/><path d="M162.999 326.519 163 356.268 161.001 356.268 161 326.519ZM165.998 354.933 162 362.942 158.002 354.933Z"/><path d="M519 95.1514 519 124.9 517.001 124.9 517.001 95.1514ZM521.998 123.565 518 131.574 514.002 123.565Z"/><path d="M519 153.244 519 182.992 517.001 182.992 517.001 153.244ZM521.998 181.657 518 189.666 514.002 181.657Z"/><path d="M519 211.336 519 241.084 517.001 241.084 517.001 211.336ZM521.998 239.749 518 247.758 514.002 239.75Z"/><path d="M519 268.427 519 298.175 517.001 298.175 517.001 268.427ZM521.998 296.84 518 304.849 514.002 296.84Z"/><path d="M519 326.519 519 356.268 517.001 356.268 517.001 326.519ZM521.998 354.933 518 362.942 514.002 354.933Z"/><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="24" transform="matrix(1 0 0 1.00159 121.552 77)">I/O请求</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="24" transform="matrix(1 0 0 1.00159 477.862 77)">I/O应答</text></g></svg>

   - 用户层软件：实现与用户交互的接口，用户可直接调用在用户层提供的、与I/O操作有关的库函数，对设备进行操作
   - 设备独立性软件：
     - 执行所有设备的公有操作，将逻辑设备映射为物理设备，对设备进行保护，禁止用户直接访问设备，缓冲管理，差错控制，提供独立于设备的大小统一的逻辑块，屏蔽设备之间信息交换单位大小和传输速率的差异
     - 向用户层或文件层提供统一接口
   - 设备驱动程序：负责具体实现系统对设备发出的操作指令，驱动I/O设备工作的驱动程序。
   - 中断处理程序：用于保存被中断的CPU环境，转入相应的中断处理程序进行处理，处理完毕后再恢复被中断进程的现场后，返回到被中断进程

### 应用程序I/O接口

1. I/O接口的分类
   - 字符设备接口：
     - 字符设备：指数据的存取和传输都是以字符为单位。基本特征是传输速率较低、不可寻址，并且在输入输出时通常采取中断驱动方式
     - 字符设备属于独占设备，为此接口还需要提供打开和关闭操作，以实现互斥共享
   - 块设备接口
     - 块设备：指数据的存取和传输都以块为单位。基本特征是传输速率较高、可寻址。设备的I/O常采用DMA方式
   - 网络设备接口
2. 阻塞I/O
   - 当用户进程调用I/O操作时，进程就被阻塞，并移到阻塞队列，I/O操作完成后，进程才被唤醒，移到就绪队列
   - 优点：操作简单，实现难度低，适合并发量小的应用
   - 缺点：I/O执行阶段进程会一直阻塞下去
3. 非阻塞I/O
   - 当用户进程调用I/O操作时，不阻塞该进程，但进程需要不断询问I/O操作是否完成，在I/O执行阶段，进程还可以做其他事情。当I/O完成后，系统将数据从内存复制到内核空间，进程继续处理数据
   - 优点：进程在等待I/O期间不会阻塞，适合并发量大的应用
   - 缺点：轮询方式询问I/O结构，会占用CPU时间

### 错题

1. 以下关于设备属性的叙述中，正确的是（）

   A. 字符设备的基本特征是可寻址到字节，即能指定输入的源地址或输出的目的地址

   B. 共享设备必须是可寻址的和可随机访问的设备

   C. 共享设备是指同一时刻内允许多个进程同时访问的设备

   D. 在分配共享设备和独占设备时都可能引起进程死锁

2. 在操作系统中，（）指的是一种硬件机制

   A. 通道技术

   B. 缓冲池

   C. SPOOLing技术

   D. 内存覆盖技术

3. 当一个进程请求I/O操作时，该进程将被挂起，直到I/O设备完成I/O操作后，设备控制器便向CPU发送一个中断请求，CPU响应后便转向中断处理程序，下列关于中断处理程序的说法中，错误的是（）

   A. 中断处理程序将设备控制器中的数据传送到内存的缓冲区，或将要输出的数据传送到设备控制器

   B. 对于不同的设备，有不同的中断处理程序

   C. 中断处理结束后，需要恢复CPU现场，此时一定返回到被中断的进程

   D. I/O操作完成后，驱动程序必须检查此次I/O操作中是否发生了错误

## 设备独立性软件

### 设备独立性软件

1. 又称与设备无关的软件，是I/O系统的最高层软件
2. 设备独立性软件包含执行所有设备公有操作

### 高速缓存和缓冲区

1. 磁盘高速缓存技术：指利用内存中的存储空间来暂存从磁盘中读出的一系列盘块中的信息

2. 磁盘高速缓存在逻辑上属于磁盘，物理上则是驻留在内存中的盘块

3. 磁盘高速缓存的两种形式

   - 在内存中开辟一个单独的空间作为缓存区，大小固定
   - 将未利用的内存空间作为一个缓冲池，供请求分页系统和磁盘I/O时共享

4. 缓冲区的作用

   - 缓和CPU和I/O设备间速度不匹配的矛盾
   - 减少对CPU的中断频率，放宽对CPU中断响应时间的限制
   - 解决基本数据单元大小不匹配的问题
   - 提高CPU和I/O设备之间的并行性

5. 缓冲区的实现方法

   - 采用硬件缓冲器
   - 利用内存作为缓冲区

6. 根据缓冲区的个数，缓冲技术可分为：

   - 单缓冲

     - 每当用户进程发出一个I/O请求时，操作系统便在内存中为之分配一个缓冲区
     - 假设从设备中将一块数据输入到缓冲区的时间为T，操作系统将缓冲区中数据传送到工作区的时间为M，CPU对这一块数据进行处理的时间为C，则单缓冲区处理每块数据的时间为Max(C, T) + M

   - 双缓冲/缓冲对换

     - 当设备输入数据时，先将数据送入缓冲区1，装满后便转向缓冲区2。此时操作系统便可以从缓冲区1中取出数据，送入用户进程，并由CPU对数据进行处理。当缓冲区1中取出的数据处理完后，若缓冲区2已满，则操作系统又从缓冲区2中取出数据送入用户进程处理，而设备可以将数据输入缓冲区1
     - 双缓冲区处理每块数据的平均时间为Max(C + M, T)

   - 循环缓冲

     - 循环缓冲包含多个大小相等的缓冲区，每个缓冲区中有一个指向下一个缓冲区的指针，最后一个缓冲区指针指向第一个缓冲区
     - 循环缓冲中还设置了in和out指针，in指向第一个可以输入数据的空缓冲区，out指向第一个可以提取数据的满缓冲区

   - 缓冲池

     - 缓冲池由多个系统公用的缓冲区组成，缓冲区按照使用情况分为：

       ```mermaid
       graph LR
       	A(缓冲区)-->B(空缓冲队列)-->C(由空缓冲区链接而成的队列)
       	A-->D(输入队列)-->E(由装满输入数据的缓冲区链接而成的队列)
       	A-->F(输出队列)-->G(由装满输出数据的缓冲区链接而成的队列)
       ```

     - 四种工作缓冲区

       ```mermaid
       graph LR
       	A(缓冲区)
       	A-->B(hin)-->C(用于收容输入数据的工作缓冲区)
       	A-->D(sin)-->E(用于提取输入数据的工作缓冲区)
       	A-->F(hout)-->G(用于收容输出数据的工作缓冲区)
       	A-->H(sout)-->I(用于提取输入数据的工作缓冲区)
       ```

     - 缓冲池中的缓冲区工作方式：

       - 收容输入：输入进程需要输入数据时，从空缓冲队列的队首摘下一个空缓冲区，作为收容输入工作缓冲区，然后将数据输入其中，装满后将它挂到输入队列的队尾
       - 提取输入：计算进程需要输入数据时，从输入队列的队首取到一个缓冲区，作为提取输入工作缓冲区，从中提取数据，用完数据后将它挂到空缓冲队列的队尾
       - 收容输出：计算进程需要输出数据时，从空缓冲队列的队首取到一个空缓冲区，作为收容输出工作缓冲区，当其中装满数据后，将它挂到输出队列的队尾
       - 提取输出：输出进程需要输出数据时，从输出队列的队首取到一个缓冲区，作为提取输出工作缓冲区，从中提取数据，用完数据后将它挂到空缓冲队列的队尾

### 设备分配和回收

1. 设备分配：根据用户的I/O请求分配所需的设备

2. 设备分配的数据结构

   - 设备控制表DCT：系统为每个设备配置一张DCT，表中的表项就是设备的各个属性
   - 控制器控制表COCT：每个设备控制器对应一张COCT，操作系统根据COCT的信息对控制器进行操作和管理。每个控制器由一个通道控制，通过相关表项可以找到相应通道的信息
   - 通道控制表CHCT：每个通道对应一张CHCT，操作系统根据CHCT的信息对通道进行操作和管理。一个通道可为多个控制器服务，通过响应表项可以找到该通道管理的所有控制器的信息
   - 系统设备表SDT：整个系统只有一张SDT，记录已连接到系统中的所有物理设备的情况，每个物理设备对应一个表目

3. 设备分配时应考虑的因素

   - 设备的固有属性
     - 独占设备
     - 共享设备
     - 虚拟设备
   - 设备分配算法
     - FCFS
     - 最高优先级优先算法
   - 设备分配的安全性
     - 安全分配方式
     - 不安全分配方式

4. 设备分配的步骤

   - 首先根据I/O请求中的物理设备名，查找SDT，从中找出对应的DCT，再根据DCT中的设备状态字段，判断设备当前是否忙，若不忙则分配
   - 设备分配后，根据DCT找到COCT，查询控制器的状态，若不忙则分配
   - 控制器分配后，根据COCT找到CHCT，查询通道是否忙，若不忙则分配

   只有当设备、控制器和通道都分配成功时，设备分配才算成功

5. 逻辑设备名道物理设备名的映射

   - 逻辑设备表LUT的每个表项中包含三个内容：逻辑设备名、物理设备名和设备驱动程序的入口地址
   - 在系统中，可采取两种方式设置逻辑设备表
     - 整个系统只设置一张LUT：所有用户不能使用相同的逻辑设备名
     - 每个用户设置一张LUT：不同用户可以使用相同的逻辑设备名

### SPOOLing技术/假脱机技术

1. 利用程序模拟外围控制机，先将低速I/O设备上的数据传送到高速磁盘上，或者相反。当CPU需要输入数据时，便可直接从磁盘上读取数据；反之，当CPU需要输出数据时，也能以很快的速度将数据先输出到磁盘上

2. SPOOLing系统的组成
   <svg width="718" height="454" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" overflow="hidden"><defs><clipPath id="clip0"><rect x="0" y="0" width="718" height="454"/></clipPath></defs><g clip-path="url(#clip0)"><rect x="0" y="0" width="718" height="453.605" fill="#FFFFFF" fill-opacity="0"/><rect x="183.5" y="107.643" width="168" height="53.0707" stroke="#042433" stroke-width="1.33302" stroke-miterlimit="8" fill="none"/><text font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="24" transform="matrix(1 0 0 1.00133 218.778 141)">输入进程</text><rect x="351.5" y="107.643" width="167" height="53.0707" stroke="#042433" stroke-width="1.33302" stroke-miterlimit="8" fill="none"/><text font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="24" transform="matrix(1 0 0 1.00133 386.28 141)">输出进程</text><rect x="183.5" y="160.714" width="335" height="245.327" stroke="#042433" stroke-width="1.33302" stroke-miterlimit="8" fill="none"/><rect x="267.5" y="203.772" width="167" height="53.0708" stroke="#042433" stroke-width="1.33302" stroke-miterlimit="8" fill="none"/><text font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="24" transform="matrix(1 0 0 1.00133 290.532 238)">输入缓冲区</text><rect x="267.5" y="309.913" width="167" height="53.0707" stroke="#042433" stroke-width="1.33302" stroke-miterlimit="8" fill="none"/><text font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="24" transform="matrix(1 0 0 1.00133 290.532 344)">输出缓冲区</text><rect x="569.5" y="203.772" width="106" height="53.0708" stroke="#042433" stroke-width="1.33302" stroke-miterlimit="8" fill="none"/><text font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="24" transform="matrix(1 0 0 1.00133 585.954 238)">输入井</text><rect x="569.5" y="309.913" width="106" height="53.0707" stroke="#042433" stroke-width="1.33302" stroke-miterlimit="8" fill="none"/><text font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="24" transform="matrix(1 0 0 1.00133 585.954 344)">输出井</text><rect x="0" y="0" width="138" height="245" stroke="#042433" stroke-width="1.33302" stroke-miterlimit="8" fill="none" transform="matrix(-1 0 0 1.00133 691.5 160.714)"/><path d="M27.5 204.773 133.754 204.773 156.5 227.549 156.5 257.844 27.5 257.844Z" stroke="#042433" stroke-width="1.33302" stroke-miterlimit="8" fill="none" fill-rule="evenodd"/><text font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="24" transform="matrix(1 0 0 1.00133 37.6526 244)">输入设备</text><path d="M0 0 106.254 0 129 22.746 129 53 0 53Z" stroke="#042433" stroke-width="1.33302" stroke-miterlimit="8" fill="none" fill-rule="evenodd" transform="matrix(-1 0 0 1.00133 156.5 308.912)"/><text font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="24" transform="matrix(1 0 0 1.00133 49.0036 349)">输出设备</text><path d="M0.00459883-0.666496 104.448 0.054162 104.438 1.38715-0.00459883 0.666496ZM103.138-3.28752 111.108 0.766646 103.082 4.71044Z" transform="matrix(1 0 0 -1.00133 156.5 230.574)"/><path d="M434.5 229.139 562.326 229.139 562.326 230.474 434.5 230.474ZM560.993 225.802 568.991 229.806 560.993 233.811Z"/><path d="M5.20174e-07-0.666512 127.826-0.666412 127.826 0.666612-5.20174e-07 0.666512ZM126.493-3.99897 134.491 0.000104963 126.493 3.99917Z" transform="matrix(-1 0 0 1.00133 568.991 335.948)"/><path d="M267.606 336.999 163.163 336.638 163.167 335.303 267.61 335.664ZM164.484 339.98 156.5 335.948 164.512 331.971Z"/><text font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="24" transform="matrix(1 0 0 1.00133 326.195 75)">内存</text></g></svg>

   - 输入井和输出井

     在磁盘上开辟出两个存储区域。输入井模拟脱机输入时的磁盘，用于收容I/O设备输入的数据。输出井模拟脱机输出时的磁盘，用于收容用户程序的输出数据。一个进程的输入/输出数据保存为一个文件，所有进程的输入/输出文件连接成一个输入/输出队列

   - 输入缓冲区和输出缓冲区

     在内存中开辟的两个缓冲区。输入缓冲区用于暂存由输入设备送来的数据，以后在输送到输入井。输出缓冲区用于暂存从输出井送来的数据，以后再传送到输出设备

   - 输入进程和输出进程

     输入进程用于模拟脱机输入时的外围控制机，将用户要求的数据从输入设备传送到输入缓冲区，在存档到输入井中。输出进程用于模拟脱机输出时的外围控制及，将用户要求输入的数据从内存传送到输出井，带输出设备空闲时，再将输出井中的数据经输出缓冲区输出到输出设备

3. SPOOLing技术的特点

   - 提高了I/O速度，将对低速I/O设备的操作变味了对磁盘缓冲区中数据的操作
   - 将独占设备改造为共享设备
   - 实现了虚拟设备功能

### 设备驱动程序接口

1. 设备驱动程序是I/O系统的上层与设备控制器之间的通信程序，其主要任务是接受上层应用发来的抽象I/O请求，将它们转换为具体要求后发送给设备控制器，进而使其启动设备执行任务；繁殖，它也将设备控制器发来的信号传送给上层应用
2. 设备驱动程序应具有以下功能
   - 接收由上层软件发来的命令和参数，并将抽象要求转换为与设备相关的具体要求
   - 检查用户I/O请求的合法性，了解设备的工作状态，传递与设备操作有关的参数，设置设备的工作方式
   - 发出I/O命令，若设备空闲，则立即启动；若设备忙，则将请求者的PCB挂载到设备的队列上等待
   - 及时响应由设备控制器发来的中断请求，并根据其中断类型，调用相应的中断处理程序进行处理
3. 设备驱动程序与普通应用/系统程序的区别
   - 设备驱动程序将抽象的I/O请求转换为具体的I/O操作后，传送给设备控制器，并将设备控制器中的记录的设备状态和I/O操作的完成情况及时反馈给进程
   - 设备驱动程序与设备采用的I/O控制方式紧密相关
   - 设备驱动程序与硬件密切相关，对于不同类型的设备，应配置不同的设备驱动程序
   - 目前很多设备驱动程序的基本部分固化在ROM中
   - 设备驱动程序允许同时多次调用执行

### 错题

1. 使用单缓冲和双缓冲进行通信时，（）可以实现数据的双向传输

   A. 只有单缓冲

   B. 只有双缓冲

   C. 都

   D. 都不

2. 缓冲区管理者重要考虑的问题是（）

   A. 选择缓冲区的大小

   B. 决定缓冲区的数量

   C. 实现进程访问缓冲区的同步

   D. 限制进程的数量

3. 提高单机资源利用率的关键技术是（）

   A. SPOOLing技术

   B. 虚拟技术

   C. 交换技术

   D. 多道程序设计技术

4. 下列关于SPOOLing的叙述中，不正确的是（）

   A. SPOOLing系统中不需要独占设备

   B. SPOOLing系统加快了作业执行的速度

   C. SPOOLing系统使独占设备变成共享设备

   D. SPOOLing系统提高了独占设备的利用率

5. 当用户要求使用打印机打印文件时，用户的要求是由操作系统的（）完成的

   A. 文件系统

   B. 设备管理程序

   C. 文件系统和设备管理程序

   D. 打印机启动程序和设备管理程序

6. 下列选项中，（）不属于设备驱动程序的功能

   A. 接收进程发来的I/O命令和参数，并检查其合法性

   B. 查询I/O设备的状态

   C. 发出I/O命令，启动I/O设备

   D. 对I/O设备传回的数据进行分析和缓冲

## 磁盘和固态硬盘

### 磁盘

1. 扇区密度从外道向内道增加，磁盘的存储能力受限于最内道的最大记录密度

2. 扇区是磁盘可寻址的最小单位，磁盘上能存储的物理块数目由扇区数、磁道数及磁盘面数决定，地盘地址用“柱面号+盘面号+扇区号”表示

3. 磁盘的分类

   ```mermaid
   graph LR
   	A(分类)
   	A-->B(根据磁头是否可移动)-->C(固定头磁盘)
   	B-->D(移动头磁盘)
   	A-->E(根据盘片是否可更换)-->F(固定盘磁盘)
   	E-->G(可换盘磁盘)
   ```

### 磁盘的管理

1. 磁盘初始化/低级格式化/物理格式化：在磁盘可以存储数据前，必须将它分成扇区，以便磁盘控制器能够进行读写操作
2. 分区：每个分区由一个或多个煮面组成，每个分区的起始扇区和大小都记录在磁盘主引导记录的分区表中
3. 高级格式化/逻辑格式化：将初始文件系统数据结构存储到磁盘上，这些数据结构包括空闲空间和已分配空间，以及一个初始为空的目录，建立根目录、对保存空闲磁盘块信息的数据结构进行初始化
4. 引导块
5. 坏块

### 磁盘的调度算法

1. 磁盘的存取时间

   - 寻道时间$T_s$：活动头磁盘在读写信息前，将磁头移动到目标磁道所需的时间。设激活磁头臂时间为$s$，则跨越n条磁道时间为：

     ```math
     T_s=m\times n+s
     ```

   - 旋转延迟时间$T_r$​：磁头定位到要读写扇区所需的时间，设磁盘的旋转速度为r，则

     ```math
     T_r=\frac{1}{2r}
     ```

   - 传输时间$T_t$：从磁盘读出或像磁盘写入数据所需要的时间，设每次读写的字节数为b，磁盘每秒旋转圈数为r，一条磁道上的字节数为N，则

     ```math
     T_t=\frac{b}{rN}
     ```

   总存取时间为:

   ```math
   T_a=T_s+T_r+T_t
   ```

2. 磁盘调度算法

   - 先来先服务算法FCFS：

     - 根据进程请求访问磁盘的先后顺序进行调度
     - 优点：简单，公平
     - 缺点：进程较多时接近于随即调度

   - 最短寻道时间优先算法SSTF

     - 每次选择调度的是与当前磁头最近的磁道，是每次的寻道时间最短
     - 缺点：可能导致饥饿

   - 扫描算法SCAN

     - 只有磁头移动到最外侧磁道时才向内侧移动，移动到最内侧磁道时才向外侧移动

     - 缺点：局部性不如FCFS和SSTF好

   - 循环扫描算法C-SCAN

     - 规定磁头单向移动来提供服务，返回时直接快速移动至起始端而不服务任何请求
   - LOOK与C-LOOK
     - SCAN与C-SCAN的改进，磁头只需要移动到最远端的一个请求即可返回，不需要达到磁盘端点

   |  算法  |             优点             |                   缺点                    |
   | :----: | :--------------------------: | :---------------------------------------: |
   |  FCFS  |          公平、简单          | 平均寻道距离大，仅应用在磁盘I/O较小的场合 |
   |  SSTF  |         性能比FCFS好         |  不能保证平均寻道时间最短，可能导致饥饿   |
   |  SCAN  |  寻道性能较好，避免饥饿现象  |       不利于远离磁头一段的访问请求        |
   | C-SCAN | 消除了对两端磁道请求的不公平 |                     —                     |

3. 减少延迟时间的方法

   - 磁盘是连续自转设备，磁头读入一个扇区后，需要经过短暂的处理时间才能开始读入下一个扇区。若逻辑上相邻的块在物理上也相邻，则读入几个连续的逻辑块可能需要很长的延迟时间

   - 交替编号：让逻辑上相邻的块物理上保持一定的间隔

     <svg width="680" height="189" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" overflow="hidden"><defs><clipPath id="clip0"><rect x="0" y="0" width="680" height="189"/></clipPath></defs><g clip-path="url(#clip0)"><rect x="0" y="0" width="680" height="189.093" fill="#FFFFFF" fill-opacity="0"/><g><path d="M192.715 57.0683C206.224 57.0683 219.18 62.4373 228.732 71.9942L192.715 108.028Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#5F5F5F" fill-rule="evenodd"/></g><g><path d="M228.732 71.9942C238.284 81.551 243.65 94.5129 243.65 108.028L192.715 108.028Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#B3B3B3" fill-rule="evenodd"/></g><g><path d="M243.65 108.028C243.65 121.544 238.284 134.505 228.732 144.062L192.715 108.028Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#898989" fill-rule="evenodd"/></g><g><path d="M228.732 144.062C219.18 153.619 206.224 158.988 192.715 158.988L192.715 108.028Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#212121" fill-rule="evenodd"/></g><g><path d="M192.715 158.988C179.207 158.988 166.251 153.619 156.699 144.062L192.715 108.028Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#DADADA" fill-rule="evenodd"/></g><g><path d="M156.699 144.062C147.147 134.505 141.78 121.544 141.78 108.028L192.715 108.028Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#AAAAAA" fill-rule="evenodd"/></g><g><path d="M141.78 108.028C141.78 94.5128 147.147 81.551 156.699 71.9942L192.715 108.028Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#7C7C7C" fill-rule="evenodd"/></g><g><path d="M156.699 71.9942C166.251 62.4373 179.207 57.0684 192.715 57.0684L192.715 108.028Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#5F5F5F" fill-rule="evenodd"/></g><g><text fill="#595959" font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="19" transform="matrix(1 0 0 1.00049 155.4 33)">连续编号</text></g><g><path d="M487.284 57.0682C500.793 57.0682 513.749 62.4372 523.301 71.994L487.284 108.028Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#5F5F5F" fill-rule="evenodd"/></g><g><path d="M523.301 71.9941C532.853 81.5509 538.219 94.5128 538.219 108.028L487.284 108.028Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#B3B3B3" fill-rule="evenodd"/></g><g><path d="M538.219 108.028C538.219 121.544 532.853 134.505 523.301 144.062L487.284 108.028Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#898989" fill-rule="evenodd"/></g><g><path d="M523.301 144.062C513.749 153.619 500.793 158.988 487.284 158.988L487.284 108.028Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#212121" fill-rule="evenodd"/></g><g><path d="M487.284 158.988C473.776 158.988 460.82 153.619 451.268 144.062L487.284 108.028Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#DADADA" fill-rule="evenodd"/></g><g><path d="M451.268 144.062C441.716 134.505 436.349 121.544 436.349 108.028L487.284 108.028Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#AAAAAA" fill-rule="evenodd"/></g><g><path d="M436.349 108.028C436.349 94.5127 441.716 81.5509 451.268 71.994L487.284 108.028Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#7C7C7C" fill-rule="evenodd"/></g><g><path d="M451.268 71.9941C460.82 62.4372 473.776 57.0683 487.284 57.0683L487.284 108.028Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#5F5F5F" fill-rule="evenodd"/></g><g><text fill="#595959" font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="19" transform="matrix(1 0 0 1.00049 449.969 33)">交替编号</text></g><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 246.279 138)">0</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 251.397 94)">7</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 219.332 54)">6</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 168.796 54)">5</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 126.264 94)">4</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 126.264 138)">3</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 168.796 175)">2</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 219.332 175)">1</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 540.855 138)">0</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 545.972 94)">7</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 513.907 54)">3</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 463.372 54)">6</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 420.839 94)">2</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 420.839 138)">5</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 463.372 175)">1</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 513.907 175)">4</text></g></svg>

   - 错位命名：不同盘面同一位置扇区编号不同
     <svg width="680" height="189" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" overflow="hidden"><defs><clipPath id="clip0"><rect x="0" y="0" width="680" height="189"/></clipPath></defs><g clip-path="url(#clip0)"><rect x="0" y="0" width="680" height="189.093" fill="#FFFFFF" fill-opacity="0"/><g><path d="M101.71 47.139C115.218 47.139 128.174 52.508 137.726 62.0648L101.71 98.0989Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#5F5F5F" fill-rule="evenodd"/></g><g><path d="M137.726 62.0648C147.278 71.6217 152.645 84.5835 152.645 98.0989L101.71 98.0989Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#B3B3B3" fill-rule="evenodd"/></g><g><path d="M152.645 98.0989C152.645 111.614 147.278 124.576 137.726 134.133L101.71 98.0989Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#898989" fill-rule="evenodd"/></g><g><path d="M137.726 134.133C128.174 143.69 115.218 149.059 101.71 149.059L101.71 98.0989Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#212121" fill-rule="evenodd"/></g><g><path d="M101.71 149.059C88.2008 149.059 75.2453 143.69 65.6932 134.133L101.71 98.0989Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#DADADA" fill-rule="evenodd"/></g><g><path d="M65.6932 134.133C56.1411 124.576 50.7747 111.614 50.7747 98.0989L101.71 98.0989Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#AAAAAA" fill-rule="evenodd"/></g><g><path d="M50.7747 98.0989C50.7747 84.5835 56.141 71.6216 65.6932 62.0648L101.71 98.0989Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#7C7C7C" fill-rule="evenodd"/></g><g><path d="M65.6932 62.0648C75.2454 52.508 88.2009 47.139 101.71 47.139L101.71 98.0989Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#5F5F5F" fill-rule="evenodd"/></g><g><text fill="#595959" font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="19" transform="matrix(1 0 0 1.00049 83.0521 23)">普通</text></g><g><path d="M245.284 47.139C258.793 47.139 271.748 52.508 281.301 62.0648L245.284 98.0989Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#5F5F5F" fill-rule="evenodd"/></g><g><path d="M281.301 62.0648C290.853 71.6217 296.219 84.5835 296.219 98.0989L245.284 98.0989Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#B3B3B3" fill-rule="evenodd"/></g><g><path d="M296.219 98.0989C296.219 111.614 290.853 124.576 281.301 134.133L245.284 98.0989Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#898989" fill-rule="evenodd"/></g><g><path d="M281.301 134.133C271.748 143.69 258.793 149.059 245.284 149.059L245.284 98.0989Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#212121" fill-rule="evenodd"/></g><g><path d="M245.284 149.059C231.775 149.059 218.82 143.69 209.268 134.133L245.284 98.0989Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#DADADA" fill-rule="evenodd"/></g><g><path d="M209.268 134.133C199.716 124.576 194.349 111.614 194.349 98.0989L245.284 98.0989Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#AAAAAA" fill-rule="evenodd"/></g><g><path d="M194.349 98.0989C194.349 84.5835 199.716 71.6216 209.268 62.0648L245.284 98.0989Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#7C7C7C" fill-rule="evenodd"/></g><g><path d="M209.268 62.0648C218.82 52.508 231.775 47.139 245.284 47.139L245.284 98.0989Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#5F5F5F" fill-rule="evenodd"/></g><g><text fill="#595959" font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="19" transform="matrix(1 0 0 1.00049 226.627 23)">命名</text></g><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 155.273 128)">0</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 160.391 84)">7</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 128.326 44)">3</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 77.7906 44)">6</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 35.2581 84)">2</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 35.2581 128)">5</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 77.7906 165)">1</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 128.326 165)">4</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 299.883 128)">0</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 305.001 84)">7</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 272.936 44)">3</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 222.4 44)">6</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 179.868 84)">2</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 179.868 128)">5</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 222.4 165)">1</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 272.936 165)">4</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="15" transform="matrix(1 0 0 1.00049 74.8988 184)">0号扇面</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="15" transform="matrix(1 0 0 1.00049 218.901 185)">1号扇面</text><g><path d="M434.716 47.7409C448.224 47.7409 461.18 53.1099 470.732 62.6667L434.716 98.7008Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#5F5F5F" fill-rule="evenodd"/></g><g><path d="M470.732 62.6667C480.284 72.2236 485.651 85.1854 485.651 98.7008L434.716 98.7008Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#B3B3B3" fill-rule="evenodd"/></g><g><path d="M485.651 98.7008C485.651 112.216 480.284 125.178 470.732 134.735L434.716 98.7008Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#898989" fill-rule="evenodd"/></g><g><path d="M470.732 134.735C461.18 144.292 448.224 149.661 434.716 149.661L434.716 98.7008Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#212121" fill-rule="evenodd"/></g><g><path d="M434.716 149.661C421.207 149.661 408.251 144.292 398.699 134.735L434.716 98.7008Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#DADADA" fill-rule="evenodd"/></g><g><path d="M398.699 134.735C389.147 125.178 383.781 112.216 383.781 98.7008L434.716 98.7008Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#AAAAAA" fill-rule="evenodd"/></g><g><path d="M383.781 98.7008C383.781 85.1854 389.147 72.2235 398.699 62.6667L434.716 98.7008Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#7C7C7C" fill-rule="evenodd"/></g><g><path d="M398.699 62.6667C408.251 53.1099 421.207 47.7409 434.716 47.7409L434.716 98.7008Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#5F5F5F" fill-rule="evenodd"/></g><g><text fill="#595959" font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="19" transform="matrix(1 0 0 1.00049 416.058 24)">错位</text></g><g><path d="M578.29 47.7409C591.799 47.7409 604.754 53.1099 614.307 62.6667L578.29 98.7008Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#5F5F5F" fill-rule="evenodd"/></g><g><path d="M614.307 62.6667C623.859 72.2236 629.225 85.1854 629.225 98.7008L578.29 98.7008Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#B3B3B3" fill-rule="evenodd"/></g><g><path d="M629.225 98.7008C629.225 112.216 623.859 125.178 614.307 134.735L578.29 98.7008Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#898989" fill-rule="evenodd"/></g><g><path d="M614.307 134.735C604.754 144.292 591.799 149.661 578.29 149.661L578.29 98.7008Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#212121" fill-rule="evenodd"/></g><g><path d="M578.29 149.661C564.781 149.661 551.826 144.292 542.274 134.735L578.29 98.7008Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#DADADA" fill-rule="evenodd"/></g><g><path d="M542.274 134.735C532.722 125.178 527.355 112.216 527.355 98.7008L578.29 98.7008Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#AAAAAA" fill-rule="evenodd"/></g><g><path d="M527.355 98.7008C527.355 85.1854 532.722 72.2235 542.274 62.6667L578.29 98.7008Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#7C7C7C" fill-rule="evenodd"/></g><g><path d="M542.274 62.6667C551.826 53.1099 564.781 47.7409 578.29 47.7409L578.29 98.7008Z" stroke="#FFFFFF" stroke-width="1.99902" stroke-linejoin="round" stroke-miterlimit="10" fill="#5F5F5F" fill-rule="evenodd"/></g><g><text fill="#595959" font-family="DengXian,DengXian_MSFontService,sans-serif" font-weight="400" font-size="19" transform="matrix(1 0 0 1.00049 559.633 24)">命名</text></g><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 488.279 128)">0</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 493.397 85)">7</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 461.332 44)">3</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 410.797 44)">6</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 368.264 85)">2</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 368.264 128)">5</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 410.797 166)">1</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 461.332 166)">4</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 632.889 128)">7</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 638.007 85)">3</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 605.942 44)">6</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 555.406 44)">2</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 512.874 85)">5</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 512.874 128)">1</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 555.406 166)">4</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="14" transform="matrix(1 0 0 1.00049 605.942 166)">0</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="15" transform="matrix(1 0 0 1.00049 407.905 185)">0号扇面</text><text font-family="Aptos,Aptos_MSFontService,sans-serif" font-weight="400" font-size="15" transform="matrix(1 0 0 1.00049 551.907 185)">1号扇面</text></g></svg>

4. 提高磁盘I/O速度的方法

   - 改进文件的目录结构及检索目录的方法，以减少对目录的查找时间
   - 选取好的文件存储结构，以提高对文件的访问速度
   - 提高磁盘I/O速度，以实现文件中的数据在磁盘和内存之间的快速传送

5. 改善磁盘I/O性能的方法

   - 采用磁盘高速缓存
   - 调整磁盘请求顺序
   - 提前读：在读磁盘当前块时，将下一磁盘块也读入内存缓冲区
   - 延迟写：仅在缓冲区首部设置延迟写标志，然后释放此缓冲区并将其链入空闲缓冲区链表的尾部，当其他进程申请到此缓冲区时，才真正将缓冲区信息写入磁盘块
   - 优化物理块分布
   - 虚拟盘：指用内存空间去仿真磁盘，又叫RAM盘，常用于存放临时文件
   - 采用磁盘整列RAID

### 固态硬盘

1. 一个SSD有一个或多个闪存芯片和闪存翻译层则称
   - 闪存芯片替代传统磁盘中的机械驱动器
   - 闪存翻译层将来自CPU的逻辑块读写请求翻译成底层物理设备的读写控制信号
2. 一个闪存由B块组成，一个块由P页组成。数据是以页为单位读写的。
3. 只有在一页所属的块整个被擦除后，才能写这一页
4. 随机写速度较慢的原因
   - 擦除块比较慢
   - 如果写操作试图修改一个包含数据的页，那么这个块中所有含有用数据的页都必须被复制到一个新块中，对老块进行擦除后才能对页进行写操作
5. 磨损均衡
   - 动态磨损均衡：写入数据时，自动选择较新的闪存块
   - 静态磨损均衡：SSD检测并自动进行数据分配，让老的闪存块只存储，不需要接受写入，同时让新的闪存块腾出空间，平时的读写操作在较新的闪存块中进行

### 错题

1. 文件系统和整个磁盘的关系是（）

   A. 没有磁盘就没有文件系统

   B. 文件系统的组织信息放在磁盘上，这些信息和代码合在一起形成文件系统

   C. 文件系统就是整个磁盘

   D. 没有关系

2. 磁盘上的文件以（）为单位读写

   A. 块

   B. 记录

   C. 柱面

   D. 磁道

3. 已知某磁盘的平均转速为r秒/转，平均寻道时间为T秒，每个磁道可以存储的字节数为N，现向该磁盘读写b字节的数据，采取随机寻道的方法，每道的所有扇区组成一个簇，其平均访问时间为（）

   A. (r + T) * b / N

   B. b / (N * T)

   C. (b / N + T) * r

   D. b * T / N + r

4. 
